Предложения по улучшению:

Возможность отслеживания работы хоста постоянно и запись в лог файл информации по дате и времени, недоступности и снова доступности.

Возможность использования скрипта в фоновом режиме и при необходимости его отключение.


Данное улучшение при запуске start.sh запускает основной скрипт ping_check.sh в фоновом режиме.

После запуска скрипт ping_check.sh записывает состояние хоста на момент запуска в файл ping_check.log (файл создается в той же директории, что и основной скрипт автоматически).

Далее скрипт делает запросы на доступность хоста с интервалом указанным в переменной sleep (по умолчанию 1 секунда).

В случае если хост доступен на момент запуска дополнительных записей в файл ping_check.log не происходит, чтобы не увеличивать лог файл.

В случае когда хост становится не доступным, происходит новая запись в файл ping_check.log с датой временем и не доступностью хоста.

Следующая запись в log файл будет при новой доступности хоста.

Так же добавлено копирование значения ячейки /dev/null сразу после её записи в переменную var. Для снижения вероятности использования некорректных данных из ячейки /dev/null в связи с работой других программ и скриптов с данной ячейкой памяти.

Основной скрипт ping_check.sh:
	
 	#!/bin/bash

	HOST="ya.ru"
	LOG_FILE="ping_check.log"
	var=""

	ping -c 1 $HOST > /dev/null
	var="$?"

	if [ $var -eq 0 ]; then
    echo "$(date): Host $HOST is up." >> $LOG_FILE
	else
    echo "$(date): Host $HOST is down." >> $LOG_FILE
	fi

	while [[ $var -le 1 ]]; do

	if [ $var -eq 1 ]; then
    echo "$(date): Host $HOST is down." >> $LOG_FILE

	    while [[ $var -eq 1 ]]; do
    	sleep 1
    	ping -c 1 $HOST > /dev/null
    	var="$?"
    	done

	echo "$(date): Host $HOST is up." >> $LOG_FILE

	else
	sleep 1
	ping -c 1 $HOST > /dev/null
	var="$?"
	fi

	done

Скрипт запуска в фоновом режиме основного скрипта ping_check.sh:

	#!/bin/bash
	nohup ./ping_check.sh >/dev/null &

Скрипт отключения основного скрипта ping_check.sh:

	#!/bin/bash
	pkill ping_check.sh


